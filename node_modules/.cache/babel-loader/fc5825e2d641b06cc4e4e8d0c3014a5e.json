{"ast":null,"code":"import _defineProperty from\"C:\\\\Users\\\\huachuan\\\\Desktop\\\\uniswap-front-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:\\\\Users\\\\huachuan\\\\Desktop\\\\uniswap-front-interface\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import{createReducer}from'@reduxjs/toolkit';import{getVersionUpgrade,VersionUpgrade}from'@uniswap/token-lists';import{DEFAULT_LIST_OF_LISTS,DEFAULT_TOKEN_LIST_URL}from'../../constants/lists';import{updateVersion}from'../global/actions';import{acceptListUpdate,addList,fetchTokenList,removeList,selectList}from'./actions';import UNISWAP_DEFAULT_LIST from'@uniswap/default-token-list';var NEW_LIST_STATE={error:null,current:null,loadingRequestId:null,pendingUpdate:null};var initialState={lastInitializedDefaultListOfLists:DEFAULT_LIST_OF_LISTS,byUrl:_objectSpread(_objectSpread({},DEFAULT_LIST_OF_LISTS.reduce(function(memo,listUrl){memo[listUrl]=NEW_LIST_STATE;return memo;},{})),{},_defineProperty({},DEFAULT_TOKEN_LIST_URL,{error:null,current:UNISWAP_DEFAULT_LIST,loadingRequestId:null,pendingUpdate:null})),selectedListUrl:undefined};export default createReducer(initialState,function(builder){return builder.addCase(fetchTokenList.pending,function(state,_ref){var _ref$payload=_ref.payload,requestId=_ref$payload.requestId,url=_ref$payload.url;state.byUrl[url]=_objectSpread(_objectSpread({current:null,pendingUpdate:null},state.byUrl[url]),{},{loadingRequestId:requestId,error:null});}).addCase(fetchTokenList.fulfilled,function(state,_ref2){var _state$byUrl$url,_state$byUrl$url2;var _ref2$payload=_ref2.payload,requestId=_ref2$payload.requestId,tokenList=_ref2$payload.tokenList,url=_ref2$payload.url;var current=(_state$byUrl$url=state.byUrl[url])===null||_state$byUrl$url===void 0?void 0:_state$byUrl$url.current;var loadingRequestId=(_state$byUrl$url2=state.byUrl[url])===null||_state$byUrl$url2===void 0?void 0:_state$byUrl$url2.loadingRequestId;// no-op if update does nothing\nif(current){var upgradeType=getVersionUpgrade(current.version,tokenList.version);if(upgradeType===VersionUpgrade.NONE)return;if(loadingRequestId===null||loadingRequestId===requestId){state.byUrl[url]=_objectSpread(_objectSpread({},state.byUrl[url]),{},{loadingRequestId:null,error:null,current:current,pendingUpdate:tokenList});}}else{state.byUrl[url]=_objectSpread(_objectSpread({},state.byUrl[url]),{},{loadingRequestId:null,error:null,current:tokenList,pendingUpdate:null});}}).addCase(fetchTokenList.rejected,function(state,_ref3){var _state$byUrl$url3;var _ref3$payload=_ref3.payload,url=_ref3$payload.url,requestId=_ref3$payload.requestId,errorMessage=_ref3$payload.errorMessage;if(((_state$byUrl$url3=state.byUrl[url])===null||_state$byUrl$url3===void 0?void 0:_state$byUrl$url3.loadingRequestId)!==requestId){// no-op since it's not the latest request\nreturn;}state.byUrl[url]=_objectSpread(_objectSpread({},state.byUrl[url]),{},{loadingRequestId:null,error:errorMessage,current:null,pendingUpdate:null});}).addCase(selectList,function(state,_ref4){var url=_ref4.payload;state.selectedListUrl=url;// automatically adds list\nif(!state.byUrl[url]){state.byUrl[url]=NEW_LIST_STATE;}}).addCase(addList,function(state,_ref5){var url=_ref5.payload;if(!state.byUrl[url]){state.byUrl[url]=NEW_LIST_STATE;}}).addCase(removeList,function(state,_ref6){var url=_ref6.payload;if(state.byUrl[url]){delete state.byUrl[url];}if(state.selectedListUrl===url){state.selectedListUrl=Object.keys(state.byUrl)[0];}}).addCase(acceptListUpdate,function(state,_ref7){var _state$byUrl$url4;var url=_ref7.payload;if(!((_state$byUrl$url4=state.byUrl[url])===null||_state$byUrl$url4===void 0?void 0:_state$byUrl$url4.pendingUpdate)){throw new Error('accept list update called without pending update');}state.byUrl[url]=_objectSpread(_objectSpread({},state.byUrl[url]),{},{pendingUpdate:null,current:state.byUrl[url].pendingUpdate});}).addCase(updateVersion,function(state){// state loaded from localStorage, but new lists have never been initialized\nif(!state.lastInitializedDefaultListOfLists){state.byUrl=initialState.byUrl;state.selectedListUrl=undefined;}else if(state.lastInitializedDefaultListOfLists){var lastInitializedSet=state.lastInitializedDefaultListOfLists.reduce(function(s,l){return s.add(l);},new Set());var newListOfListsSet=DEFAULT_LIST_OF_LISTS.reduce(function(s,l){return s.add(l);},new Set());DEFAULT_LIST_OF_LISTS.forEach(function(listUrl){if(!lastInitializedSet.has(listUrl)){state.byUrl[listUrl]=NEW_LIST_STATE;}});state.lastInitializedDefaultListOfLists.forEach(function(listUrl){if(!newListOfListsSet.has(listUrl)){delete state.byUrl[listUrl];}});}state.lastInitializedDefaultListOfLists=DEFAULT_LIST_OF_LISTS;});});","map":{"version":3,"sources":["C:/Users/huachuan/Desktop/uniswap-front-interface/src/state/lists/reducer.ts"],"names":["createReducer","getVersionUpgrade","VersionUpgrade","DEFAULT_LIST_OF_LISTS","DEFAULT_TOKEN_LIST_URL","updateVersion","acceptListUpdate","addList","fetchTokenList","removeList","selectList","UNISWAP_DEFAULT_LIST","NEW_LIST_STATE","error","current","loadingRequestId","pendingUpdate","initialState","lastInitializedDefaultListOfLists","byUrl","reduce","memo","listUrl","selectedListUrl","undefined","builder","addCase","pending","state","payload","requestId","url","fulfilled","tokenList","upgradeType","version","NONE","rejected","errorMessage","Object","keys","Error","lastInitializedSet","s","l","add","Set","newListOfListsSet","forEach","has"],"mappings":"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","sourcesContent":["import { createReducer } from '@reduxjs/toolkit'\nimport { getVersionUpgrade, VersionUpgrade } from '@uniswap/token-lists'\nimport { TokenList } from '@uniswap/token-lists/dist/types'\nimport { DEFAULT_LIST_OF_LISTS, DEFAULT_TOKEN_LIST_URL } from '../../constants/lists'\nimport { updateVersion } from '../global/actions'\nimport { acceptListUpdate, addList, fetchTokenList, removeList, selectList } from './actions'\nimport UNISWAP_DEFAULT_LIST from '@uniswap/default-token-list'\n\nexport interface ListsState {\n  readonly byUrl: {\n    readonly [url: string]: {\n      readonly current: TokenList | null\n      readonly pendingUpdate: TokenList | null\n      readonly loadingRequestId: string | null\n      readonly error: string | null\n    }\n  }\n  // this contains the default list of lists from the last time the updateVersion was called, i.e. the app was reloaded\n  readonly lastInitializedDefaultListOfLists?: string[]\n  readonly selectedListUrl: string | undefined\n}\n\nconst NEW_LIST_STATE: ListsState['byUrl'][string] = {\n  error: null,\n  current: null,\n  loadingRequestId: null,\n  pendingUpdate: null\n}\n\ntype Mutable<T> = { -readonly [P in keyof T]: T[P] extends ReadonlyArray<infer U> ? U[] : T[P] }\n\nconst initialState: ListsState = {\n  lastInitializedDefaultListOfLists: DEFAULT_LIST_OF_LISTS,\n  byUrl: {\n    ...DEFAULT_LIST_OF_LISTS.reduce<Mutable<ListsState['byUrl']>>((memo, listUrl) => {\n      memo[listUrl] = NEW_LIST_STATE\n      return memo\n    }, {}),\n    [DEFAULT_TOKEN_LIST_URL]: {\n      error: null,\n      current: UNISWAP_DEFAULT_LIST,\n      loadingRequestId: null,\n      pendingUpdate: null\n    }\n  },\n  selectedListUrl: undefined\n}\n\nexport default createReducer(initialState, builder =>\n  builder\n    .addCase(fetchTokenList.pending, (state, { payload: { requestId, url } }) => {\n      state.byUrl[url] = {\n        current: null,\n        pendingUpdate: null,\n        ...state.byUrl[url],\n        loadingRequestId: requestId,\n        error: null\n      }\n    })\n    .addCase(fetchTokenList.fulfilled, (state, { payload: { requestId, tokenList, url } }) => {\n      const current = state.byUrl[url]?.current\n      const loadingRequestId = state.byUrl[url]?.loadingRequestId\n\n      // no-op if update does nothing\n      if (current) {\n        const upgradeType = getVersionUpgrade(current.version, tokenList.version)\n        if (upgradeType === VersionUpgrade.NONE) return\n        if (loadingRequestId === null || loadingRequestId === requestId) {\n          state.byUrl[url] = {\n            ...state.byUrl[url],\n            loadingRequestId: null,\n            error: null,\n            current: current,\n            pendingUpdate: tokenList\n          }\n        }\n      } else {\n        state.byUrl[url] = {\n          ...state.byUrl[url],\n          loadingRequestId: null,\n          error: null,\n          current: tokenList,\n          pendingUpdate: null\n        }\n      }\n    })\n    .addCase(fetchTokenList.rejected, (state, { payload: { url, requestId, errorMessage } }) => {\n      if (state.byUrl[url]?.loadingRequestId !== requestId) {\n        // no-op since it's not the latest request\n        return\n      }\n\n      state.byUrl[url] = {\n        ...state.byUrl[url],\n        loadingRequestId: null,\n        error: errorMessage,\n        current: null,\n        pendingUpdate: null\n      }\n    })\n    .addCase(selectList, (state, { payload: url }) => {\n      state.selectedListUrl = url\n      // automatically adds list\n      if (!state.byUrl[url]) {\n        state.byUrl[url] = NEW_LIST_STATE\n      }\n    })\n    .addCase(addList, (state, { payload: url }) => {\n      if (!state.byUrl[url]) {\n        state.byUrl[url] = NEW_LIST_STATE\n      }\n    })\n    .addCase(removeList, (state, { payload: url }) => {\n      if (state.byUrl[url]) {\n        delete state.byUrl[url]\n      }\n      if (state.selectedListUrl === url) {\n        state.selectedListUrl = Object.keys(state.byUrl)[0]\n      }\n    })\n    .addCase(acceptListUpdate, (state, { payload: url }) => {\n      if (!state.byUrl[url]?.pendingUpdate) {\n        throw new Error('accept list update called without pending update')\n      }\n      state.byUrl[url] = {\n        ...state.byUrl[url],\n        pendingUpdate: null,\n        current: state.byUrl[url].pendingUpdate\n      }\n    })\n    .addCase(updateVersion, state => {\n      // state loaded from localStorage, but new lists have never been initialized\n      if (!state.lastInitializedDefaultListOfLists) {\n        state.byUrl = initialState.byUrl\n        state.selectedListUrl = undefined\n      } else if (state.lastInitializedDefaultListOfLists) {\n        const lastInitializedSet = state.lastInitializedDefaultListOfLists.reduce<Set<string>>(\n          (s, l) => s.add(l),\n          new Set()\n        )\n        const newListOfListsSet = DEFAULT_LIST_OF_LISTS.reduce<Set<string>>((s, l) => s.add(l), new Set())\n\n        DEFAULT_LIST_OF_LISTS.forEach(listUrl => {\n          if (!lastInitializedSet.has(listUrl)) {\n            state.byUrl[listUrl] = NEW_LIST_STATE\n          }\n        })\n\n        state.lastInitializedDefaultListOfLists.forEach(listUrl => {\n          if (!newListOfListsSet.has(listUrl)) {\n            delete state.byUrl[listUrl]\n          }\n        })\n      }\n\n      state.lastInitializedDefaultListOfLists = DEFAULT_LIST_OF_LISTS\n    })\n)\n"]},"metadata":{},"sourceType":"module"}